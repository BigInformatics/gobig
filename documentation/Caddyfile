:80 {
	# Set root directory
	root * /usr/share/caddy
	
	# Enable gzip compression
	encode gzip zstd
	
	# Security headers
	header {
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		-Server
	}
	
	# Cache control for static assets
	@static {
		path *.jpg *.jpeg *.png *.gif *.ico *.css *.js *.svg *.woff *.woff2 *.ttf *.eot
	}
	header @static Cache-Control "public, max-age=31536000, immutable"
	
	# Don't cache HTML files
	@html {
		path *.html
	}
	header @html Cache-Control "no-cache, must-revalidate"
	
	# Try files in order, fall back to index.html for SPA
	try_files {path} {path}/ {path}.html /index.html
	
	# Serve files
	file_server
	
	# Custom 404 page
	handle_errors {
		@404 {
			expression {http.error.status_code} == 404
		}
		rewrite @404 /404.html
		file_server
	}
	
	# Logging
	log {
		output stdout
		format console
	}
}
